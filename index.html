<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QSC App (TEST)</title>
    <style>
        /* --- General & Mobile-First Styles --- */
        :root {
            --bg-color: #121212;
            --primary-color: #1e1e1e;
            --secondary-color: #2a2a2a;
            --text-color: #e0e0e0;
            --text-muted-color: #888;
            --accent-color: #007bff;
            --danger-color: #e53935;
            --success-color: #43a047;
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html { font-family: var(--font-family); background-color: var(--bg-color); color: var(--text-color); }
        body { padding: 1rem; }
        .hidden { display: none !important; }

        #access-denied { text-align: center; padding: 4rem 1rem; font-size: 1.2rem; color: var(--danger-color); }

        /* --- App Structure --- */
        #app-container h1 { text-align: center; margin-bottom: 1rem; color: var(--accent-color); font-weight: 500; }
        .content-section h2 { font-size: 1.5rem; text-align: center; margin-bottom: 1.5rem; font-weight: 400; color: var(--text-muted-color); }
        
        /* --- Notification Setup --- */
        #notification-setup { background-color: var(--secondary-color); padding: 0.75rem; border-radius: 8px; margin-bottom: 1.5rem; text-align: center; }
        #notification-setup p { margin-bottom: 0.5rem; }
        #enable-notifications-btn { background-color: var(--accent-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        /* --- Tabs --- */
        .tabs { display: flex; margin-bottom: 1.5rem; }
        .tab-button { flex: 1; padding: 1rem 0.5rem; background-color: var(--primary-color); color: var(--text-color); border: none; cursor: pointer; font-size: 1rem; transition: background-color 0.2s; border-bottom: 3px solid transparent; }
        .tab-button.active { background-color: var(--secondary-color); border-bottom-color: var(--accent-color); font-weight: bold; }
        .tab-button:not(:last-child) { border-right: 1px solid var(--bg-color); }
        
        .content-section { display: none; }
        .content-section.active { display: block; }
        
        /* --- Shared Button Styles --- */
        .primary-button {
            width: 100%;
            padding: 1.25rem;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--success-color);
            color: white;
            transition: background-color 0.3s, opacity 0.3s;
        }
        .primary-button:disabled { background-color: var(--secondary-color); color: var(--text-muted-color); cursor: not-allowed; }
        
        .secondary-button {
            background-color: transparent;
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
            padding: 0.75rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 1rem;
            width: 100%;
        }

        /* --- Checklist Specific Styles --- */
        #checklist-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        #checklist-header h2 { margin-bottom: 0; }
        #edit-list-btn { background: none; border: none; color: var(--accent-color); font-size: 1.5rem; cursor: pointer; }

        #add-task-form { display: flex; margin-bottom: 1rem; }
        #new-task-input { flex-grow: 1; padding: 0.75rem; border: 1px solid var(--secondary-color); background-color: var(--bg-color); color: var(--text-color); border-radius: 5px 0 0 5px; }
        #add-task-btn { padding: 0.75rem; border: none; background-color: var(--accent-color); color: white; border-radius: 0 5px 5px 0; cursor: pointer; font-weight: bold; }

        .task-item { display: flex; align-items: center; background-color: var(--primary-color); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; }
        .task-item.checked label { text-decoration: line-through; color: var(--text-muted-color); }
        .task-item input[type="checkbox"] { width: 1.5rem; height: 1.5rem; margin-right: 1rem; accent-color: var(--accent-color); cursor: pointer; }
        .task-item label { flex-grow: 1; font-size: 1.1rem; }
        .delete-task-btn { background: none; border: none; color: var(--danger-color); font-size: 1.2rem; cursor: pointer; padding: 0 0.5rem; font-weight: bold; }

        /* --- Responsive for Larger Screens --- */
        @media (min-width: 768px) {
            body { max-width: 600px; margin: 2rem auto; }
        }
    </style>
</head>
<body>

    <div id="access-denied" class="hidden">
        <h1>Access Denied</h1>
    </div>

    <div id="app-container" class="hidden">
        <h1>QSC App (TEST)</h1>

        <div id="notification-setup">
            <p id="notification-message">For reminders to work, you must enable notifications.</p>
            <button id="enable-notifications-btn">Enable Notifications</button>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="fries">Fries</button>
            <button class="tab-button" data-tab="sanitizer">Sanitizer</button>
            <button class="tab-button" data-tab="checklist">Checklist</button>
        </div>

        <div class="tab-content">
            <!-- Fries Section -->
            <div id="fries" class="content-section active">
                <h2>Fry Blanching Timer</h2>
                <button id="fries-btn" class="primary-button">Start Fry Blanching Process</button>
            </div>

            <!-- Sanitizer Section -->
            <div id="sanitizer" class="content-section">
                <h2>Sanitizer Replacement</h2>
                <button id="sanitizer-btn" class="primary-button">Start First Sanitizer Timer</button>
                <button id="sanitizer-reset-btn" class="secondary-button hidden">Stop and Reset for the Day</button>
            </div>

            <!-- Checklist Section -->
            <div id="checklist" class="content-section">
                <div id="checklist-header">
                    <h2>Daily Tasks</h2>
                    <button id="edit-list-btn">⚙️</button>
                </div>
                <form id="add-task-form" class="hidden">
                    <input type="text" id="new-task-input" placeholder="Enter new task...">
                    <button type="submit" id="add-task-btn">Add</button>
                </form>
                <div id="checklist-tasks"></div>
                <button id="reset-all-tasks-btn" class="secondary-button" style="margin-top: 1.5rem;">Reset All Tasks</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONFIGURATION & SECURITY ---
        const STORE_PASSWORD = '0';
        const MANAGER_PIN = '1';
        
        // --- MODIFIED VALUES FOR TESTING ---
        const SANITIZER_CUTOFF_HOUR = new Date().getHours() + 1; // Test Value: Cutoff is the NEXT full hour.
        const FRIES_STAGE1_DURATION_MIN = 0.5;  // Test Value: 30 seconds
        const FRIES_STAGE2_DURATION_MIN = 0.25; // Test Value: 15 seconds
        const SANITIZER_DURATION_MIN = 0.4;   // Test Value: 24 seconds
        // --- END OF MODIFIED VALUES ---

        const appContainer = document.getElementById('app-container');
        const accessDenied = document.getElementById('access-denied');
        
        const password = prompt('Please enter the Store Password:');
        if (password === STORE_PASSWORD) {
            appContainer.classList.remove('hidden');
            initializeApp();
        } else {
            document.body.innerHTML = '';
            document.body.appendChild(accessDenied);
            accessDenied.classList.remove('hidden');
        }

        function initializeApp() {
            // --- GLOBAL DOM ELEMENTS ---
            const notifyBtn = document.getElementById('enable-notifications-btn');
            const notifyMsg = document.getElementById('notification-message');
            const notificationSetup = document.getElementById('notification-setup');

            // --- NOTIFICATION HANDLING ---
            if ('Notification' in window && Notification.permission === 'granted') {
                notificationSetup.classList.add('hidden');
            }
            notifyBtn.addEventListener('click', () => {
                if ('Notification' in window) {
                    Notification.requestPermission().then(() => notificationSetup.classList.add('hidden'));
                } else {
                    notifyMsg.textContent = 'Notifications not supported on this browser.';
                    notifyBtn.classList.add('hidden');
                }
            });

            // --- UTILITY FUNCTIONS ---
            const sendNotification = (title, body) => {
                if ('Notification' in window && Notification.permission === 'granted') {
                    new Notification(title, { body });
                }
            };
            const formatTime = (date) => date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });

            // --- TAB SWITCHING ---
            const tabButtons = document.querySelectorAll('.tab-button');
            const contentSections = document.querySelectorAll('.content-section');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    contentSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(button.dataset.tab).classList.add('active');
                });
            });

            // --- FRIES LOGIC ---
            const friesBtn = document.getElementById('fries-btn');
            let friesState = JSON.parse(localStorage.getItem('friesState')) || {};

            function updateFriesUI() {
                if (!friesState.stage1EndTime) {
                    friesBtn.disabled = false;
                    friesBtn.textContent = 'Start Fry Blanching Process';
                    return;
                }
                
                friesBtn.disabled = true;
                const totalEndTime = new Date(friesState.stage2EndTime);
                friesBtn.textContent = `Process ends at ${formatTime(totalEndTime)}`;
            }

            function checkFriesStatus() {
                if (!friesState.stage1EndTime) return;

                const now = Date.now();

                // Check for Stage 1 completion
                if (now >= friesState.stage1EndTime && !friesState.stage1Notified) {
                    sendNotification('QSC Reminder', 'Time to move fries to the cooler (uncovered).');
                    friesState.stage1Notified = true;
                    localStorage.setItem('friesState', JSON.stringify(friesState));
                }

                // Check for Stage 2 completion
                if (now >= friesState.stage2EndTime && !friesState.stage2Notified) {
                    sendNotification('QSC Reminder', 'Check fry temp (35-40°F) and COVER the fries.');
                    friesState = {}; // Reset state
                    localStorage.removeItem('friesState');
                    updateFriesUI();
                }
            }

            friesBtn.addEventListener('click', () => {
                if (friesBtn.disabled) return;
                
                const now = new Date();
                const stage1EndTime = new Date(now.getTime() + FRIES_STAGE1_DURATION_MIN * 60000);
                const stage2EndTime = new Date(stage1EndTime.getTime() + FRIES_STAGE2_DURATION_MIN * 60000);

                friesState = {
                    stage1EndTime: stage1EndTime.getTime(),
                    stage2EndTime: stage2EndTime.getTime(),
                    stage1Notified: false,
                    stage2Notified: false
                };
                localStorage.setItem('friesState', JSON.stringify(friesState));
                updateFriesUI();
            });

            // --- SANITIZER LOGIC ---
            const sanitizerBtn = document.getElementById('sanitizer-btn');
            const sanitizerResetBtn = document.getElementById('sanitizer-reset-btn');
            let sanitizerState = JSON.parse(localStorage.getItem('sanitizerState')) || {};

            function updateSanitizerUI() {
                if (!sanitizerState.endTime) {
                    sanitizerBtn.disabled = false;
                    sanitizerBtn.textContent = 'Start First Sanitizer Timer';
                    sanitizerResetBtn.classList.add('hidden');
                    return;
                }

                sanitizerResetBtn.classList.remove('hidden');
                const now = Date.now();
                const endTime = sanitizerState.endTime;
                
                if (now < endTime) { // Timer is running
                    sanitizerBtn.disabled = true;
                    sanitizerBtn.textContent = `Next replacement due at ${formatTime(new Date(endTime))}`;
                } else { // Timer expired
                    sanitizerBtn.disabled = false;
                    sanitizerBtn.textContent = 'Sanitizer Replaced - Start Next 2-Hour Timer';
                }
            }

            function checkSanitizerStatus() {
                if (!sanitizerState.endTime || sanitizerState.notified) return;
                
                if (Date.now() >= sanitizerState.endTime) {
                    sendNotification('QSC Reminder', 'Time to replace the sanitizer buckets!');
                    sanitizerState.notified = true;
                    localStorage.setItem('sanitizerState', JSON.stringify(sanitizerState));
                    updateSanitizerUI(); // Update UI to enable the button
                }
            }

            sanitizerBtn.addEventListener('click', () => {
                if (sanitizerBtn.disabled) return;

                const now = new Date();
                const nextEndTime = new Date(now.getTime() + SANITIZER_DURATION_MIN * 60000);

                // Check if the next timer would end after the cutoff time
                if (nextEndTime.getHours() >= SANITIZER_CUTOFF_HOUR) {
                    alert(`TEST MODE: The next timer would end after the cutoff time (${formatTime(new Date().setHours(SANITIZER_CUTOFF_HOUR, 0, 0))}). Resetting for the next day.`);
                    sanitizerState = {};
                    localStorage.removeItem('sanitizerState');
                } else {
                    sanitizerState = {
                        endTime: nextEndTime.getTime(),
                        notified: false
                    };
                    localStorage.setItem('sanitizerState', JSON.stringify(sanitizerState));
                }
                updateSanitizerUI();
            });

            sanitizerResetBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to stop the sanitizer timer for the day?')) {
                    sanitizerState = {};
                    localStorage.removeItem('sanitizerState');
                    updateSanitizerUI();
                }
            });

            // --- CHECKLIST LOGIC ---
            const checklistHeader = document.getElementById('checklist-header');
            const editListBtn = document.getElementById('edit-list-btn');
            const addTaskForm = document.getElementById('add-task-form');
            const newTaskInput = document.getElementById('new-task-input');
            const checklistTasksContainer = document.getElementById('checklist-tasks');
            const resetAllTasksBtn = document.getElementById('reset-all-tasks-btn');
            let isManagerMode = false;
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [
                { text: 'Wipe down counters', checked: false },
                { text: 'Stock napkins & condiments', checked: false },
                { text: 'Check & clean restrooms', checked: false }
            ];

            function saveTasks() {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }

            function renderChecklist() {
                checklistTasksContainer.innerHTML = '';
                tasks.forEach((task, index) => {
                    const taskItem = document.createElement('div');
                    taskItem.className = `task-item ${task.checked ? 'checked' : ''}`;
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = task.checked;
                    checkbox.id = `task-${index}`;
                    checkbox.dataset.index = index;
                    checkbox.addEventListener('change', (e) => {
                        tasks[index].checked = e.target.checked;
                        taskItem.classList.toggle('checked', e.target.checked);
                        saveTasks();
                    });

                    const label = document.createElement('label');
                    label.textContent = task.text;
                    label.htmlFor = `task-${index}`;

                    taskItem.appendChild(checkbox);
                    taskItem.appendChild(label);
                    
                    if (isManagerMode) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'delete-task-btn';
                        deleteBtn.textContent = '✖';
                        deleteBtn.dataset.index = index;
                        deleteBtn.addEventListener('click', (e) => {
                            tasks.splice(index, 1);
                            saveTasks();
                            renderChecklist();
                        });
                        taskItem.appendChild(deleteBtn);
                    }
                    checklistTasksContainer.appendChild(taskItem);
                });
            }

            editListBtn.addEventListener('click', () => {
                if (isManagerMode) {
                    isManagerMode = false;
                    editListBtn.textContent = '⚙️';
                    addTaskForm.classList.add('hidden');
                } else {
                    const pin = prompt('Enter Manager PIN:');
                    if (pin === MANAGER_PIN) {
                        isManagerMode = true;
                        editListBtn.textContent = 'Lock List';
                        addTaskForm.classList.remove('hidden');
                    } else if (pin) {
                        alert('Incorrect PIN.');
                    }
                }
                renderChecklist();
            });

            addTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const text = newTaskInput.value.trim();
                if (text) {
                    tasks.push({ text, checked: false });
                    newTaskInput.value = '';
                    saveTasks();
                    renderChecklist();
                }
            });

            resetAllTasksBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to uncheck all tasks?')) {
                    tasks.forEach(task => task.checked = false);
                    saveTasks();
                    renderChecklist();
                }
            });


            // --- INITIALIZATION & MAIN LOOP ---
            function mainLoop() {
                checkFriesStatus();
                checkSanitizerStatus();
            }

            // Initial UI setup on load
            updateFriesUI();
            updateSanitizerUI();
            renderChecklist();

            // Start main loop to check timers every second
            setInterval(mainLoop, 1000);
        }
    });
    </script>
</body>
</html>
